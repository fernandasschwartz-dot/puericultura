<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Puericultura Dra Schwartz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --lilas:#7c3aed;--bg:#faf7ff;--card:#fff;--border:#e5e7eb;
  --alto:#dc2626;--medio:#f59e0b;--baixo:#16a34a;
}
body{margin:0;font-family:system-ui;background:var(--bg)}
.container{max-width:1200px;margin:auto;padding:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:14px}
h1{color:var(--lilas);margin:0}
h2{margin:0 0 8px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
label{font-size:12px;font-weight:600}
input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--border)}
button{padding:10px 14px;border-radius:12px;border:none;background:var(--lilas);color:#fff;font-weight:700;cursor:pointer}
.badge{padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;display:inline-block}
.alto{background:#fee2e2;color:var(--alto)}
.medio{background:#ffedd5;color:var(--medio)}
.baixo{background:#dcfce7;color:var(--baixo)}
.alert{margin-top:6px;font-size:13px}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <div class="card" style="max-width:400px;margin:auto">
    <h1>Puericultura Dra Schwartz</h1>
    <p>Acesso restrito</p>
    <input id="email" placeholder="E-mail">
    <input id="senha" type="password" placeholder="Senha" style="margin-top:8px">
    <button style="margin-top:10px" onclick="login()">Entrar</button>
    <div id="loginErro" style="color:red"></div>
  </div>
</div>

<!-- APP -->
<div class="container" id="app" style="display:none">

<h1>üíú Puericultura Dra Schwartz üë∂</h1>
<p>Sistema de acompanhamento infantil ‚Äì OMS / MS</p>

<!-- PAINEL DE ATEN√á√ÉO -->
<div class="card">
<h2>‚ö†Ô∏è Crian√ßas que exigem aten√ß√£o</h2>
<div id="painelAtencao"></div>
</div>

<!-- CADASTRO DA CRIAN√áA -->
<div class="card">
<h2>Cadastro da crian√ßa</h2>
<div class="grid">
  <div><label>Nome</label><input id="nome"></div>
  <div><label>Data nascimento</label><input type="date" id="dn"></div>
  <div><label>Sexo</label><select id="sexo"><option>M</option><option>F</option></select></div>
  <div><label>Via de parto</label><select id="parto"><option>Vaginal</option><option>Ces√°rea</option></select></div>
  <div><label>IG ao nascer (semanas)</label><input id="ig" type="number"></div>
  <div><label>Doen√ßas pr√©vias</label><input id="doencas"></div>
</div>
<label style="margin-top:8px">Antecedentes maternos / gestacionais</label>
<textarea id="maternos"></textarea>
<button onclick="salvarCrianca()">Salvar crian√ßa</button>
</div>

<!-- CONSULTA -->
<div class="card">
<h2>Consulta</h2>
<div class="grid">
  <div><label>Peso (kg)</label><input id="peso" type="number" step="0.01"></div>
  <div><label>Altura (cm)</label><input id="altura" type="number"></div>
  <div><label>PC (cm)</label><input id="pc" type="number"></div>
</div>
<button onclick="salvarConsulta()">Salvar consulta</button>
</div>

<!-- VACINAS -->
<div class="card">
<h2>Vacinas (PNI)</h2>
<div class="grid">
<label><input type="checkbox" id="bcg"> BCG</label>
<label><input type="checkbox" id="hepB"> Hepatite B</label>
<label><input type="checkbox" id="penta"> Pentavalente</label>
<label><input type="checkbox" id="vip"> VIP</label>
<label><input type="checkbox" id="rota"> Rotav√≠rus</label>
</div>
</div>

<div class="card">
<button onclick="exportarJSON()">Exportar JSON</button>
<button onclick="gerarPDF()">PDF crian√ßa</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// üîê CONFIGURA√á√ÉO FIREBASE (OFICIAL)
const firebaseConfig = {
  apiKey: "AIzaSyAg0HPhWoqbEhjybTYDfBg1AQbCbbIquaE",
  authDomain: "gerenciador-draschwartz.firebaseapp.com",
  projectId: "gerenciador-draschwartz",
  storageBucket: "gerenciador-draschwartz.firebasestorage.app",
  messagingSenderId: "283430261434",
  appId: "1:283430261434:web:4c2681d93f99c3c1382883",
  measurementId: "G-R7TE29MLKB"
};

const fbApp = initializeApp(firebaseConfig);
const auth = getAuth(fbApp);

window.login = async ()=>{
 try{
  await signInWithEmailAndPassword(auth,email.value,senha.value)
 }catch(e){loginErro.innerText='Erro no login'}
}

onAuthStateChanged(auth,(user)=>{
 if(user){loginBox.style.display='none';app.style.display='block'}
 else{loginBox.style.display='block';app.style.display='none'}
});

let criancas=[];let ativa=null;
const idadeMeses = d => Math.floor((new Date()-new Date(d))/2629800000);

window.salvarCrianca=()=>{
 ativa={id:Date.now(),nome:nome.value,dn:dn.value,sexo:sexo.value,parto:parto.value,ig:ig.value,
 doencas:doencas.value,maternos:maternos.value,consultas:[],vacinas:{bcg:bcg.checked,hepB:hepB.checked,penta:penta.checked,vip:vip.checked,rota:rota.checked}};
 criancas.push(ativa);atualizarPainel();alert('Crian√ßa salva');
}

window.salvarConsulta=()=>{
 if(!ativa)return;
 ativa.consultas.push({peso:peso.value,altura:altura.value,pc:pc.value});
 atualizarPainel();alert('Consulta salva');
}

function risco(c){
 let r={txt:'Risco habitual üü¢',cls:'baixo'};
 if(Object.values(c.vacinas).includes(false)) r={txt:'Risco intermedi√°rio üü†',cls:'medio'};
 if(c.consultas.length>0) r={txt:'Alto risco üî¥',cls:'alto'};
 return r;
}

function atualizarPainel(){
 painelAtencao.innerHTML='';
 criancas.forEach(c=>{
  const r=risco(c);
  const d=document.createElement('div');
  d.className='alert '+r.cls;
  d.innerHTML=`<strong>${c.nome}</strong> ‚Äì ${idadeMeses(c.dn)} meses<br>${r.txt}`;
  painelAtencao.appendChild(d);
 });
}

window.exportarJSON=()=>{
 const blob=new Blob([JSON.stringify(criancas,null,2)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='puericultura.json';a.click();
}

window.gerarPDF=()=>{window.print()}
</script>

</body>
</html>
